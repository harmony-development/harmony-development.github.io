<!DOCTYPE html>
<html lang="en-us"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
    <title>Permissions | Harmony</title>
    <meta name="description" content="The permissions system of Harmony resembles that of the permissions system common to open-source Minecraft server software, featuring rules and querying a node string against those rules.
Permission In a community, there will be features, management functionality, bot commands, and other things which exist. Most of these actions have a permission associated with them, allowing you to control which members have access to each feature.
A permission is just a string, such as roles. ">
    <link rel="canonical" href="https://harmonyapp.io/docs/permissions/" />

    

    
      
      <link rel="stylesheet" href="/css/main.min.ffa2c263a52247f69e606278e3b3ab33849b5ce18bb062835eece5ca3730b038.css" integrity="sha256-/6LCY6UiR/aeYGJ447OrM4SbXOGLsGKDXuzlyjcwsDg="/>
    

    <meta property="og:title" content="Permissions" />
<meta property="og:description" content="The permissions system of Harmony resembles that of the permissions system common to open-source Minecraft server software, featuring rules and querying a node string against those rules.
Permission In a community, there will be features, management functionality, bot commands, and other things which exist. Most of these actions have a permission associated with them, allowing you to control which members have access to each feature.
A permission is just a string, such as roles." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://harmonyapp.io/docs/permissions/" />


    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Permissions"/>
<meta name="twitter:description" content="The permissions system of Harmony resembles that of the permissions system common to open-source Minecraft server software, featuring rules and querying a node string against those rules.
Permission In a community, there will be features, management functionality, bot commands, and other things which exist. Most of these actions have a permission associated with them, allowing you to control which members have access to each feature.
A permission is just a string, such as roles."/>

    <meta name="theme-color" content="#E93D58">
    <meta property="og:image" content="https://harmonyapp.io/img/harmony-embed.png" />

    <script src="https://unpkg.com/quicklink@2.0.0/dist/quicklink.umd.js"></script>
    <script defer>
        quicklink.listen()
    </script>
</head>
<body class="dark:text-white"><header class="w-full bg-gray-200 header flex text-lg">
  <div class="flex flex-row w-full items-center">
    <div class="flex-auto px-3 justify-start order-first inline-flex">
      <a class="font-header" href="/">
        <span class="font-light">Harmony </span
        ><span class="font-bold">Chat</span>
      </a>
    </div>
    <div class="flex-auto p-2 justify-end order-last inline-flex gap-1">
      
      <a
        href="/docs/faq"
        class="
          ml-2
          nu-top-app-bar__link
          h1-minor-minor
          border-2 border-transparent
          px-2
          hover:border-current hover:bg-white hover:bg-opacity-5
          rounded-sm
          transition
          duration-100
        "
      >
        FAQ
      </a>
      
      <a
        href="/docs"
        class="
          ml-2
          nu-top-app-bar__link
          h1-minor-minor
          border-2 border-transparent
          px-2
          hover:border-current hover:bg-white hover:bg-opacity-5
          rounded-sm
          transition
          duration-100
        "
      >
        Docs
      </a>
      
      <a
        href="https://github.com/harmony-development"
        class="
          ml-2
          nu-top-app-bar__link
          h1-minor-minor
          border-2 border-transparent
          px-2
          hover:border-current hover:bg-white hover:bg-opacity-5
          rounded-sm
          transition
          duration-100
        "
      >
        Github
      </a>
      
    </div>
  </div>
</header>
<main>

<div class="prose-wrapper">
  <aside class="prose-toc">
    <h4><strong>Table Of Contents</strong></h4>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#permission">Permission</a></li>
    <li><a href="#rule">Rule</a></li>
    <li><a href="#role">Role</a></li>
    <li><a href="#overrides">Overrides</a></li>
    <li><a href="#evaluation">Evaluation</a></li>
  </ul>
</nav>
  </aside>
  <div class="flex justify-center pb-8 w-full">
    <article class="prose">
      <h1 class="h1">Permissions</h1>
      <p>The permissions system of Harmony resembles that of the permissions system common
to open-source Minecraft server software, featuring rules and querying a node string
against those rules.</p>
<h2 id="permission">Permission</h2>
<p>In a community, there will be features, management functionality, bot commands, and other things which exist.
Most of these actions have a permission associated with them, allowing you to control which members have access to each feature.</p>
<p>A permission is just a string, such as <code>roles.user.manage</code>, separated into parts using periods.</p>
<p>This string is also referred to as a permission node, or just node for short.</p>
<h2 id="rule">Rule</h2>
<p>A rule is a string that matches permissions, using UNIX-style globbing and parameter expansion.
This matching string is paired with a mode, which will either allow or deny permissions that match the string.</p>
<p>The rule <code>roles.*</code> will match <code>roles.user.manage</code> and <code>roles.user.view</code>.
This is a star-expression, meaning that anything beginning with the text before the star and ending with the text after the star will match.
Only one star-expression is permitted within a rule.</p>
<p>The rule <code>roles.user.{manage,view}</code> will match <code>roles.user.manage</code> and <code>roles.user.view</code>, but not <code>roles.user.share</code>.
This is an or-expression, meaning that <code>a.{b,c}</code> will match both <code>a.b</code> and <code>a.c</code>.
Any amount of items can be put in the or-expression&rsquo;s braces: <code>a.{b,c,d}</code> will match both <code>a.b</code>, <code>a.c</code>, and <code>a.d</code>.
Multiple or-expressions can compound, in which they effectively &ldquo;multiply&rdquo; the amount of items they expand to.</p>
<p><code>a.{b,c}.{d,e}</code> will expand to <code>a.b.d</code>, <code>a.b.e</code>, <code>a.c.d</code>, and <code>a.c.e</code>.</p>
<h2 id="role">Role</h2>
<p>A role is a collection of rules, which can be assigned to users.
These are named and coloured for aesthetic reasons.</p>
<p>Each guild MUST have a default role. This role MUST have the ID <code>0</code>.
The default role will not be included in <code>GetGuildRoles</code> or <code>GetUserRoles</code>.
Clients are free to show it however they want.</p>
<h2 id="overrides">Overrides</h2>
<p>A role can also have channel and category-specific overrides, which are a collection of rules that take precedence over the guild-level set of rules.
Actions may query permissions in the context of a specific channel.
For example, you may want to allow <code>@everyone</code> to <code>messages.send</code> in most channels, but deny them that permission to send messages in an announcements channel.</p>
<p>Some actions may not query permissions in a channel or category, such as changing the name of a community.</p>
<p>If an action queries in the context of a channel, it&rsquo;ll first check the overrides of the channel, then the rules of the category of the channel if applicable, then the rules associated with a guild.</p>
<h2 id="evaluation">Evaluation</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// Mode determines whether a permission will glob or not
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Mode</span> <span style="color:#66d9ef">int</span>

<span style="color:#75715e">// RoleID is the ID of a role
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">RoleID</span> <span style="color:#66d9ef">uint64</span>

<span style="color:#75715e">// ChannelID is the ID of a channel
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">ChannelID</span> <span style="color:#66d9ef">uint64</span>

<span style="color:#66d9ef">const</span> (
    <span style="color:#75715e">// Allow permission
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Allow</span> <span style="color:#a6e22e">Mode</span> = <span style="color:#66d9ef">iota</span>
    <span style="color:#75715e">// Deny permission
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Deny</span>
)

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">PermissionGlob</span> <span style="color:#66d9ef">struct</span> {
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">PermissionGlob</span>) <span style="color:#a6e22e">Match</span>(<span style="color:#a6e22e">str</span> <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">bool</span> {
    <span style="color:#75715e">// return true if the string matches this glob,
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// otherwise false
</span><span style="color:#75715e"></span>}

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">PermissionNode</span> <span style="color:#66d9ef">struct</span> {
    <span style="color:#a6e22e">Glob</span> <span style="color:#a6e22e">PermissionGlob</span>
    <span style="color:#a6e22e">Mode</span>
}

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">GuildState</span> <span style="color:#66d9ef">struct</span> {
    <span style="color:#75715e">// map of role IDs to list of permission nodes
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Roles</span>      <span style="color:#66d9ef">map</span>[<span style="color:#a6e22e">RoleID</span>][]<span style="color:#a6e22e">PermissionNode</span>

    <span style="color:#75715e">// map of channel IDs to parent channel IDs (categories)
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Categories</span> <span style="color:#66d9ef">map</span>[<span style="color:#a6e22e">ChannelID</span>]<span style="color:#a6e22e">ChannelID</span>

    <span style="color:#75715e">// map of channel IDs to map of role IDs to list of permission nodes
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Channels</span>   <span style="color:#66d9ef">map</span>[<span style="color:#a6e22e">ChannelID</span>]<span style="color:#66d9ef">map</span>[<span style="color:#a6e22e">RoleID</span>][]<span style="color:#a6e22e">PermissionNode</span>
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">g</span> <span style="color:#a6e22e">GuildState</span>) <span style="color:#a6e22e">Check</span>(<span style="color:#a6e22e">permission</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">userRoles</span> []<span style="color:#66d9ef">uint64</span>, <span style="color:#a6e22e">in</span> <span style="color:#a6e22e">ChannelID</span>) <span style="color:#66d9ef">bool</span> {
    <span style="color:#a6e22e">userRoles</span> = append(<span style="color:#a6e22e">userRoles</span>, uint64(<span style="color:#a6e22e">Everyone</span>))

    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">in</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span> {
        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">channelData</span>, <span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">g</span>.<span style="color:#a6e22e">Channels</span>[<span style="color:#a6e22e">in</span>]; <span style="color:#a6e22e">ok</span> {
            <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">role</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">userRoles</span> {
                <span style="color:#a6e22e">nodes</span>, <span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">channelData</span>[<span style="color:#a6e22e">RoleID</span>(<span style="color:#a6e22e">role</span>)]
                <span style="color:#a6e22e">_</span> = <span style="color:#a6e22e">ok</span>
                <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">node</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">nodes</span> {
                    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">node</span>.<span style="color:#a6e22e">Glob</span>.<span style="color:#a6e22e">Match</span>(<span style="color:#a6e22e">permission</span>) {
                        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">node</span>.<span style="color:#a6e22e">Mode</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">Allow</span>
                    }
                }
            }
        }

        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">category</span>, <span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">g</span>.<span style="color:#a6e22e">Categories</span>[<span style="color:#a6e22e">in</span>]; <span style="color:#a6e22e">ok</span> {
            <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">channelData</span>, <span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">g</span>.<span style="color:#a6e22e">Channels</span>[<span style="color:#a6e22e">category</span>]; <span style="color:#a6e22e">ok</span> {
                <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">role</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">userRoles</span> {
                    <span style="color:#a6e22e">nodes</span>, <span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">channelData</span>[<span style="color:#a6e22e">RoleID</span>(<span style="color:#a6e22e">role</span>)]
                    <span style="color:#a6e22e">_</span> = <span style="color:#a6e22e">ok</span>
                    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">node</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">nodes</span> {
                        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">node</span>.<span style="color:#a6e22e">Glob</span>.<span style="color:#a6e22e">Match</span>(<span style="color:#a6e22e">permission</span>) {
                            <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">node</span>.<span style="color:#a6e22e">Mode</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">Allow</span>
                        }
                    }
                }
            }
        }
    }

    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">role</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">userRoles</span> {
        <span style="color:#a6e22e">nodes</span>, <span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">g</span>.<span style="color:#a6e22e">Roles</span>[<span style="color:#a6e22e">RoleID</span>(<span style="color:#a6e22e">role</span>)]
        <span style="color:#a6e22e">_</span> = <span style="color:#a6e22e">ok</span>
        <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">node</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">nodes</span> {
            <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">node</span>.<span style="color:#a6e22e">Glob</span>.<span style="color:#a6e22e">Match</span>(<span style="color:#a6e22e">permission</span>) {
                <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">node</span>.<span style="color:#a6e22e">Mode</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">Allow</span>
            }
        }
    }

    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
}
</code></pre></div>
    </article>
  </div>
</div>


        </main><footer class="py-8 bg-light-900 dark:bg-dark-900 flex justify-center">
  <div class="max-w-prose">Harmony Development</div>
</footer>
</body>
</html>
