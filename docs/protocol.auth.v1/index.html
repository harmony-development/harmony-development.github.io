<!DOCTYPE html>
<html lang="en-us"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
    <title>Reference: protocol.auth.v1 | Harmony</title>
    <meta name="description" content="Message Types BeginAuthRequest Used in BeginAuth endpoint.
This item has no fields.
BeginAuthResponse BeginAuthResponse The return type of BeginAuth, containing the auth_id that will be used for the authentication section
Fields auth_id (optional string) auth_id: the ID of this auth session
Session Session Session contains the information for a new session; the user_id you logged in as and the session_token which should be passed to authorisation
Fields user_id (optional uint64) user_id: the ID of the user you logged in as ">
    <link rel="canonical" href="https://harmonyapp.io/docs/protocol.auth.v1/" />

    

    
      
      <link rel="stylesheet" href="/css/main.min.ffa2c263a52247f69e606278e3b3ab33849b5ce18bb062835eece5ca3730b038.css" integrity="sha256-/6LCY6UiR/aeYGJ447OrM4SbXOGLsGKDXuzlyjcwsDg="/>
    

    <meta property="og:title" content="Reference: protocol.auth.v1" />
<meta property="og:description" content="Message Types BeginAuthRequest Used in BeginAuth endpoint.
This item has no fields.
BeginAuthResponse BeginAuthResponse The return type of BeginAuth, containing the auth_id that will be used for the authentication section
Fields auth_id (optional string) auth_id: the ID of this auth session
Session Session Session contains the information for a new session; the user_id you logged in as and the session_token which should be passed to authorisation
Fields user_id (optional uint64) user_id: the ID of the user you logged in as" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://harmonyapp.io/docs/protocol.auth.v1/" />


    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Reference: protocol.auth.v1"/>
<meta name="twitter:description" content="Message Types BeginAuthRequest Used in BeginAuth endpoint.
This item has no fields.
BeginAuthResponse BeginAuthResponse The return type of BeginAuth, containing the auth_id that will be used for the authentication section
Fields auth_id (optional string) auth_id: the ID of this auth session
Session Session Session contains the information for a new session; the user_id you logged in as and the session_token which should be passed to authorisation
Fields user_id (optional uint64) user_id: the ID of the user you logged in as"/>

    <meta name="theme-color" content="#E93D58">
    <meta property="og:image" content="https://harmonyapp.io/img/harmony-embed.png" />

    <script src="https://unpkg.com/quicklink@2.0.0/dist/quicklink.umd.js"></script>
    <script defer>
        quicklink.listen()
    </script>
</head>
<body class="dark:text-white"><header class="w-full bg-gray-200 header flex text-lg">
  <div class="flex flex-row w-full items-center">
    <div class="flex-auto px-3 justify-start order-first inline-flex">
      <a class="font-header" href="/">
        <span class="font-light">Harmony </span
        ><span class="font-bold">Chat</span>
      </a>
    </div>
    <div class="flex-auto p-2 justify-end order-last inline-flex gap-1">
      
      <a
        href="/docs/faq"
        class="
          ml-2
          nu-top-app-bar__link
          h1-minor-minor
          border-2 border-transparent
          px-2
          hover:border-current hover:bg-white hover:bg-opacity-5
          rounded-sm
          transition
          duration-100
        "
      >
        FAQ
      </a>
      
      <a
        href="/docs"
        class="
          ml-2
          nu-top-app-bar__link
          h1-minor-minor
          border-2 border-transparent
          px-2
          hover:border-current hover:bg-white hover:bg-opacity-5
          rounded-sm
          transition
          duration-100
        "
      >
        Docs
      </a>
      
      <a
        href="https://github.com/harmony-development"
        class="
          ml-2
          nu-top-app-bar__link
          h1-minor-minor
          border-2 border-transparent
          px-2
          hover:border-current hover:bg-white hover:bg-opacity-5
          rounded-sm
          transition
          duration-100
        "
      >
        Github
      </a>
      
    </div>
  </div>
</header>
<main>

<div class="prose-wrapper">
  <aside class="prose-toc">
    <h4><strong>Table Of Contents</strong></h4>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#message-types">Message Types</a>
      <ul>
        <li><a href="#beginauthrequest">BeginAuthRequest</a></li>
        <li><a href="#beginauthresponse">BeginAuthResponse</a></li>
        <li><a href="#session">Session</a></li>
        <li><a href="#authstep">AuthStep</a></li>
        <li><a href="#authstepchoice">AuthStep.Choice</a></li>
        <li><a href="#authstepform">AuthStep.Form</a></li>
        <li><a href="#authstepformformfield">AuthStep.Form.FormField</a></li>
        <li><a href="#authstepwaiting">AuthStep.Waiting</a></li>
        <li><a href="#nextsteprequest">NextStepRequest</a></li>
        <li><a href="#nextsteprequestchoice">NextStepRequest.Choice</a></li>
        <li><a href="#nextsteprequestformfields">NextStepRequest.FormFields</a></li>
        <li><a href="#nextsteprequestform">NextStepRequest.Form</a></li>
        <li><a href="#nextstepresponse">NextStepResponse</a></li>
        <li><a href="#stepbackrequest">StepBackRequest</a></li>
        <li><a href="#stepbackresponse">StepBackResponse</a></li>
        <li><a href="#streamstepsrequest">StreamStepsRequest</a></li>
        <li><a href="#streamstepsresponse">StreamStepsResponse</a></li>
        <li><a href="#federaterequest">FederateRequest</a></li>
        <li><a href="#federateresponse">FederateResponse</a></li>
        <li><a href="#keyrequest">KeyRequest</a></li>
        <li><a href="#keyresponse">KeyResponse</a></li>
        <li><a href="#loginfederatedrequest">LoginFederatedRequest</a></li>
        <li><a href="#loginfederatedresponse">LoginFederatedResponse</a></li>
        <li><a href="#tokendata">TokenData</a></li>
        <li><a href="#checkloggedinrequest">CheckLoggedInRequest</a></li>
        <li><a href="#checkloggedinresponse">CheckLoggedInResponse</a></li>
      </ul>
    </li>
    <li><a href="#services">Services</a>
      <ul>
        <li><a href="#authservice">AuthService</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </aside>
  <div class="flex justify-center pb-8 w-full">
    <article class="prose">
      <h1 class="h1">Reference: protocol.auth.v1</h1>
      <h2 id="message-types">Message Types</h2>
<h3 id="beginauthrequest">BeginAuthRequest</h3>
<p>Used in <code>BeginAuth</code> endpoint.</p>
<p>This item has no fields.</p>
<h3 id="beginauthresponse">BeginAuthResponse</h3>
<p>BeginAuthResponse
The return type of BeginAuth, containing the
auth_id that will be used for the authentication
section</p>
<h4 id="fields">Fields</h4>
<h5 id="auth_id-optional--string">auth_id (optional  <code>string</code>)</h5>
<p>auth_id: the ID of this auth session</p>
<h3 id="session">Session</h3>
<p>Session
Session contains the information for a new session;
the user_id you logged in as and the session_token
which should be passed to authorisation</p>
<h4 id="fields-1">Fields</h4>
<h5 id="user_id-optional--uint64">user_id (optional  <code>uint64</code>)</h5>
<p>user_id: the ID of the user you logged in as</p>
<h5 id="session_token-optional--string">session_token (optional  <code>string</code>)</h5>
<p>session_token: the session token to use in authorization</p>
<h3 id="authstep">AuthStep</h3>
<p>AuthStep
A step in the authentication process
Contains a variety of different types of views
It is recommended to have a fallback_url specified
For non-trivial authentication procedures (such as captchas)</p>
<h4 id="fields-2">Fields</h4>
<h5 id="fallback_url-optional--string">fallback_url (optional  <code>string</code>)</h5>
<p>fallback_url: unused</p>
<h5 id="can_go_back-optional--bool">can_go_back (optional  <code>bool</code>)</h5>
<p>can_go_back: whether or not the client can request the
server to send the previous step</p>
<h5 id="choice-optional--protocolauthv1authstepchoiceauthstepchoice">choice (optional  <a href="#authstepchoice">protocol.auth.v1.AuthStep.Choice</a>)</h5>
<p>choice: the user must pick a thing out of a list of options</p>
<h5 id="form-optional--protocolauthv1authstepformauthstepform">form (optional  <a href="#authstepform">protocol.auth.v1.AuthStep.Form</a>)</h5>
<p>form: the user must complete a form</p>
<h5 id="session-optional--protocolauthv1sessionsession">session (optional  <a href="#session">protocol.auth.v1.Session</a>)</h5>
<p>session: you&rsquo;ve completed auth, and have a session</p>
<h5 id="waiting-optional--protocolauthv1authstepwaitingauthstepwaiting">waiting (optional  <a href="#authstepwaiting">protocol.auth.v1.AuthStep.Waiting</a>)</h5>
<p>waiting: you&rsquo;re waiting on something</p>
<h3 id="authstepchoice">AuthStep.Choice</h3>
<h4 id="fields-3">Fields</h4>
<h5 id="title-optional--string">title (optional  <code>string</code>)</h5>
<h5 id="options-repeated--string">options (repeated  <code>string</code>)</h5>
<h3 id="authstepform">AuthStep.Form</h3>
<h4 id="fields-4">Fields</h4>
<h5 id="title-optional--string-1">title (optional  <code>string</code>)</h5>
<h5 id="fields-repeated--protocolauthv1authstepformformfieldauthstepformformfield">fields (repeated  <a href="#authstepformformfield">protocol.auth.v1.AuthStep.Form.FormField</a>)</h5>
<h3 id="authstepformformfield">AuthStep.Form.FormField</h3>
<h4 id="fields-5">Fields</h4>
<h5 id="name-optional--string">name (optional  <code>string</code>)</h5>
<h5 id="type-optional--string">type (optional  <code>string</code>)</h5>
<h3 id="authstepwaiting">AuthStep.Waiting</h3>
<h4 id="fields-6">Fields</h4>
<h5 id="title-optional--string-2">title (optional  <code>string</code>)</h5>
<h5 id="description-optional--string">description (optional  <code>string</code>)</h5>
<h3 id="nextsteprequest">NextStepRequest</h3>
<p>NextStepRequest
contains the client&rsquo;s response to the server&rsquo;s challenge
This needs to be called first with no arguments to
receive the first step</p>
<h4 id="fields-7">Fields</h4>
<h5 id="auth_id-optional--string-1">auth_id (optional  <code>string</code>)</h5>
<p>auth_id: the authentication session you want
the next step of</p>
<h5 id="choice-optional--protocolauthv1nextsteprequestchoicenextsteprequestchoice">choice (optional  <a href="#nextsteprequestchoice">protocol.auth.v1.NextStepRequest.Choice</a>)</h5>
<p>choice: the choice the user picked</p>
<h5 id="form-optional--protocolauthv1nextsteprequestformnextsteprequestform">form (optional  <a href="#nextsteprequestform">protocol.auth.v1.NextStepRequest.Form</a>)</h5>
<p>form: the form the user filled out</p>
<h3 id="nextsteprequestchoice">NextStepRequest.Choice</h3>
<h4 id="fields-8">Fields</h4>
<h5 id="choice-optional--string">choice (optional  <code>string</code>)</h5>
<h3 id="nextsteprequestformfields">NextStepRequest.FormFields</h3>
<h4 id="fields-9">Fields</h4>
<h5 id="bytes-optional--bytes">bytes (optional  <code>bytes</code>)</h5>
<h5 id="string-optional--string">string (optional  <code>string</code>)</h5>
<h5 id="number-optional--int64">number (optional  <code>int64</code>)</h5>
<h3 id="nextsteprequestform">NextStepRequest.Form</h3>
<h4 id="fields-10">Fields</h4>
<h5 id="fields-repeated--protocolauthv1nextsteprequestformfieldsnextsteprequestformfields">fields (repeated  <a href="#nextsteprequestformfields">protocol.auth.v1.NextStepRequest.FormFields</a>)</h5>
<h3 id="nextstepresponse">NextStepResponse</h3>
<p>Used in <code>NextStep</code> endpoint.</p>
<h4 id="fields-11">Fields</h4>
<h5 id="step-optional--protocolauthv1authstepauthstep">step (optional  <a href="#authstep">protocol.auth.v1.AuthStep</a>)</h5>
<p>step: the next step in the authentication process</p>
<h3 id="stepbackrequest">StepBackRequest</h3>
<p>StepBackRequest
A request to go back 1 step</p>
<h4 id="fields-12">Fields</h4>
<h5 id="auth_id-optional--string-2">auth_id (optional  <code>string</code>)</h5>
<p>auth_id: the authentication session the user
wants to go back in</p>
<h3 id="stepbackresponse">StepBackResponse</h3>
<p>Used in <code>StepBack</code> endpoint.</p>
<h4 id="fields-13">Fields</h4>
<h5 id="step-optional--protocolauthv1authstepauthstep-1">step (optional  <a href="#authstep">protocol.auth.v1.AuthStep</a>)</h5>
<p>step: the previous step in the authentication process</p>
<h3 id="streamstepsrequest">StreamStepsRequest</h3>
<p>StreamStepsRequest
Required to be initiated by all authenticating clients
Allows the server to send steps</p>
<h4 id="fields-14">Fields</h4>
<h5 id="auth_id-optional--string-3">auth_id (optional  <code>string</code>)</h5>
<p>auth_id: the authorization session
who&rsquo;s steps you want to stream</p>
<h3 id="streamstepsresponse">StreamStepsResponse</h3>
<p>Used in <code>StreamSteps</code> endpoint.</p>
<h4 id="fields-15">Fields</h4>
<h5 id="step-optional--protocolauthv1authstepauthstep-2">step (optional  <a href="#authstep">protocol.auth.v1.AuthStep</a>)</h5>
<p>step: the next step in the authentication process</p>
<h3 id="federaterequest">FederateRequest</h3>
<p>The request to federate with a foreign server.</p>
<h4 id="fields-16">Fields</h4>
<h5 id="server_id-optional--string">server_id (optional  <code>string</code>)</h5>
<p>The server ID foreign server you want to federate with</p>
<h3 id="federateresponse">FederateResponse</h3>
<p>The reply to a successful federation request,
containing the token you need to present to the
foreign server.</p>
<h4 id="fields-17">Fields</h4>
<h5 id="token-optional--protocolharmonytypesv1tokenhahahugoshortcode-s0-hbhbtoken">token (optional  <a href="https://harmonyapp.io/docs/protocol.harmonytypes.v1/#token">protocol.harmonytypes.v1.Token</a>)</h5>
<p>A <code>harmonytypes.v1.Token</code> whose <code>data</code> field is a serialized <code>TokenData</code> message.
It is signed with the homeserver&rsquo;s private key.</p>
<h3 id="keyrequest">KeyRequest</h3>
<p>Used in <code>Key</code> endpoint.</p>
<p>This item has no fields.</p>
<h3 id="keyresponse">KeyResponse</h3>
<p>Contains a key&rsquo;s bytes.</p>
<h4 id="fields-18">Fields</h4>
<h5 id="key-optional--bytes">key (optional  <code>bytes</code>)</h5>
<p>key: the bytes of the public key.</p>
<h3 id="loginfederatedrequest">LoginFederatedRequest</h3>
<p>Log into a foreignserver using a token
from your homeserver, obtained through a FederateRequest</p>
<h4 id="fields-19">Fields</h4>
<h5 id="auth_token-optional--protocolharmonytypesv1tokenhahahugoshortcode-s1-hbhbtoken">auth_token (optional  <a href="https://harmonyapp.io/docs/protocol.harmonytypes.v1/#token">protocol.harmonytypes.v1.Token</a>)</h5>
<p>A <code>harmonytypes.v1.Token</code> whose <code>data</code> field is a serialized <code>TokenData</code> message.
It is signed with the homeserver&rsquo;s private key.</p>
<h5 id="server_id-optional--string-1">server_id (optional  <code>string</code>)</h5>
<p>The server ID of the homeserver that the auth token is from</p>
<h3 id="loginfederatedresponse">LoginFederatedResponse</h3>
<p>Used in <code>LoginFederated</code> endpoint.</p>
<h4 id="fields-20">Fields</h4>
<h5 id="session-optional--protocolauthv1sessionsession-1">session (optional  <a href="#session">protocol.auth.v1.Session</a>)</h5>
<p>The user&rsquo;s session.</p>
<h3 id="tokendata">TokenData</h3>
<p>Information sent by a client&rsquo;s homeserver, in a <code>harmonytypes.v1.Token</code>.
It will be sent to a foreignserver by the client.</p>
<h4 id="fields-21">Fields</h4>
<h5 id="user_id-optional--uint64-1">user_id (optional  <code>uint64</code>)</h5>
<p>The client&rsquo;s user ID on the homeserver.</p>
<h5 id="server_id-optional--string-2">server_id (optional  <code>string</code>)</h5>
<p>The foreignserver&rsquo;s server ID.</p>
<h5 id="username-optional--string">username (optional  <code>string</code>)</h5>
<p>The username of the client.</p>
<h5 id="avatar-optional--string">avatar (optional  <code>string</code>)</h5>
<p>The avatar of the client.</p>
<h3 id="checkloggedinrequest">CheckLoggedInRequest</h3>
<p>Used in <code>CheckLoggedIn</code> endpoint.</p>
<p>This item has no fields.</p>
<h3 id="checkloggedinresponse">CheckLoggedInResponse</h3>
<p>Used in <code>CheckLoggedIn</code> endpoint.</p>
<p>This item has no fields.</p>
<h2 id="services">Services</h2>
<h3 id="authservice">AuthService</h3>
<p>The service containing authorization/entication methods</p>
<h4 id="methods">Methods</h4>
<h5 id="federate">Federate</h5>
<p><a href="#federaterequest">protocol.auth.v1.FederateRequest</a> -&gt; <a href="#federateresponse">protocol.auth.v1.FederateResponse</a></p>
<p>Federate with a foreignserver, obtaining a token
you can use to call LoginFederated on it</p>
<h5 id="loginfederated">LoginFederated</h5>
<p><a href="#loginfederatedrequest">protocol.auth.v1.LoginFederatedRequest</a> -&gt; <a href="#loginfederatedresponse">protocol.auth.v1.LoginFederatedResponse</a></p>
<p>Present a token to a foreignserver from a Federate call
on your homeserver in order to login</p>
<h5 id="key">Key</h5>
<p><a href="#keyrequest">protocol.auth.v1.KeyRequest</a> -&gt; <a href="#keyresponse">protocol.auth.v1.KeyResponse</a></p>
<p>Returns the public key of this server</p>
<h5 id="beginauth">BeginAuth</h5>
<p><a href="#beginauthrequest">protocol.auth.v1.BeginAuthRequest</a> -&gt; <a href="#beginauthresponse">protocol.auth.v1.BeginAuthResponse</a></p>
<p>Begins an authentication session</p>
<h5 id="nextstep">NextStep</h5>
<p><a href="#nextsteprequest">protocol.auth.v1.NextStepRequest</a> -&gt; <a href="#nextstepresponse">protocol.auth.v1.NextStepResponse</a></p>
<p>Goes to the next step of the authentication session,
possibly presenting user input</p>
<h5 id="stepback">StepBack</h5>
<p><a href="#stepbackrequest">protocol.auth.v1.StepBackRequest</a> -&gt; <a href="#stepbackresponse">protocol.auth.v1.StepBackResponse</a></p>
<p>Goes to the previous step of the authentication session
if possible</p>
<h5 id="streamsteps">StreamSteps</h5>
<p><a href="#streamstepsrequest">protocol.auth.v1.StreamStepsRequest</a> -&gt; streaming <a href="#streamstepsresponse">protocol.auth.v1.StreamStepsResponse</a></p>
<p>Consume the steps of an authentication session
as a stream</p>
<h5 id="checkloggedin">CheckLoggedIn</h5>
<p><a href="#checkloggedinrequest">protocol.auth.v1.CheckLoggedInRequest</a> -&gt; <a href="#checkloggedinresponse">protocol.auth.v1.CheckLoggedInResponse</a></p>
<p>Check whether or not you&rsquo;re logged in and the session is valid</p>

    </article>
  </div>
</div>


        </main><footer class="py-8 bg-light-900 dark:bg-dark-900 flex justify-center">
  <div class="max-w-prose">Harmony Development</div>
</footer>
</body>
</html>
